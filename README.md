 <style type="text/css">html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; } .mac-os-11 { --title-bar-height:28px; } html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; } body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; } iframe { margin: auto; } a.url { word-break: break-all; } a:active, a:hover { outline: 0px; } .in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); } #write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; } #write.first-line-indent p { text-indent: 2em; } #write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; } #write.first-line-indent li { margin-left: 2em; } .for-image #write { padding-left: 8px; padding-right: 8px; } body.typora-export { padding-left: 30px; padding-right: 30px; } .typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; } .typora-export .task-list-item input { pointer-events: none; } @media screen and (max-width: 500px) { body.typora-export { padding-left: 0px; padding-right: 0px; } #write { padding-left: 20px; padding-right: 20px; } .CodeMirror-sizer { margin-left: 0px !important; } .CodeMirror-gutters { display: none !important; } } #write li > figure:last-child { margin-bottom: 0.5rem; } #write ol, #write ul { position: relative; } img { max-width: 100%; vertical-align: middle; image-orientation: from-image; } button, input, select, textarea { color: inherit; font: inherit; } input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; } *, ::after, ::before { box-sizing: border-box; } #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; } #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; } p { line-height: inherit; } h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; } p { orphans: 4; } h1 { font-size: 2rem; } h2 { font-size: 1.8rem; } h3 { font-size: 1.6rem; } h4 { font-size: 1.4rem; } h5 { font-size: 1.2rem; } h6 { font-size: 1rem; } .md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; } .hidden { display: none; } .md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; } a { cursor: pointer; } sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; } sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; } #write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; } figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; } figure > table { margin: 0px; } tr { break-inside: avoid; break-after: auto; } thead { display: table-header-group; } table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; } table.md-table td { min-width: 32px; } .CodeMirror-gutters { border-right: 0px; background-color: inherit; } .CodeMirror-linenumber { user-select: none; } .CodeMirror { text-align: left; } .CodeMirror-placeholder { opacity: 0.3; } .CodeMirror pre { padding: 0px 4px; } .CodeMirror-lines { padding: 0px; } div.hr:focus { cursor: none; } #write pre { white-space: pre-wrap; } #write.fences-no-line-wrapping pre { white-space: pre; } #write pre.ty-contain-cm { white-space: normal; } .CodeMirror-gutters { margin-right: 4px; } .md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; } .md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; } #write .md-fences.mock-cm { white-space: pre-wrap; } .md-fences.md-fences-with-lineno { padding-left: 0px; } #write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; } .md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; } .CodeMirror-line, twitterwidget { break-inside: avoid; } .footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; } .footnotes + .footnotes { margin-top: 0px; } .md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; } li div { padding-top: 0px; } blockquote { margin: 1rem 0px; } li .mathjax-block, li p { margin: 0.5rem 0px; } li blockquote { margin: 1rem 0px; } li { margin: 0px; position: relative; } blockquote > :last-child { margin-bottom: 0px; } blockquote > :first-child, li > :first-child { margin-top: 0px; } .footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; } #write .footnote-line { white-space: pre-wrap; } @media print { body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; } #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; } .typora-export * { -webkit-print-color-adjust: exact; } .typora-export #write { break-after: avoid; } .typora-export #write::after { height: 0px; } .is-mac table { break-inside: avoid; } .typora-export-show-outline .typora-export-sidebar { display: none; } } .footnote-line { margin-top: 0.714em; font-size: 0.7em; } a img, img a { cursor: pointer; } pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; } p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; } #write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; } p > .md-image:only-child { display: inline-block; width: 100%; } #write .MathJax_Display { margin: 0.8em 0px 0px; } .md-math-block { width: 100%; } .md-math-block:not(:empty)::after { display: none; } .MathJax_ref { fill: currentcolor; } [contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; } .md-task-list-item { position: relative; list-style-type: none; } .task-list-item.md-task-list-item { padding-left: 0px; } .md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; } .math { font-size: 1rem; } .md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; } .md-toc-content { position: relative; margin-left: 0px; } .md-toc-content::after, .md-toc::after { display: none; } .md-toc-item { display: block; color: rgb(65, 131, 196); } .md-toc-item a { text-decoration: none; } .md-toc-inner:hover { text-decoration: underline; } .md-toc-inner { display: inline-block; cursor: pointer; } .md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; } .md-toc-h2 .md-toc-inner { margin-left: 2em; } .md-toc-h3 .md-toc-inner { margin-left: 4em; } .md-toc-h4 .md-toc-inner { margin-left: 6em; } .md-toc-h5 .md-toc-inner { margin-left: 8em; } .md-toc-h6 .md-toc-inner { margin-left: 10em; } @media screen and (max-width: 48em) { .md-toc-h3 .md-toc-inner { margin-left: 3.5em; } .md-toc-h4 .md-toc-inner { margin-left: 5em; } .md-toc-h5 .md-toc-inner { margin-left: 6.5em; } .md-toc-h6 .md-toc-inner { margin-left: 8em; } } a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; } .footnote-line a:not(.reversefootnote) { color: inherit; } .md-attr { display: none; } .md-fn-count::after { content: "."; } code, pre, samp, tt { font-family: var(--monospace); } kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; } .md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); } code { text-align: left; vertical-align: initial; } a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; } .os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; } .md-diagram-panel > svg { max-width: 100%; } [lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; } [lang="mermaid"] .node text { font-size: 1rem; } table tr th { border-bottom: 0px; } video { max-width: 100%; display: block; margin: 0px auto; } iframe { max-width: 100%; width: 100%; border: none; } .highlight td, .highlight tr { border: 0px; } mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); } .md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; } .md-expand mark .md-meta { opacity: 0.3 !important; } mark .md-meta { color: rgb(0, 0, 0); } @media print { .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; } } .md-diagram-panel .messageText { stroke: none !important; } .md-diagram-panel .start-state { fill: var(--node-fill); } .md-diagram-panel .edgeLabel rect { opacity: 1 !important; } .md-fences.md-fences-math { font-size: 1em; } .md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; } .md-fences-advanced:not(.md-focus) { background: inherit; } .typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; } .typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; } .typora-export-show-outline #write { --webkit-flex:2; flex: 2 1 0%; } .typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; } @media screen and (max-width: 1024px) { .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; } } @media screen and (max-width: 800px) { .typora-export-sidebar { display: none; } } .outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; } .outline-content ul { margin-top: 0px; margin-bottom: 0px; } .outline-content strong { font-weight: 400; } .outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; } .outline-expander::before { content: "ï„¥"; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; } .outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; } .outline-expander:hover::before { content: "ï„£"; } .outline-h1 > .outline-item { padding-left: 0px; } .outline-h2 > .outline-item { padding-left: 1em; } .outline-h3 > .outline-item { padding-left: 2em; } .outline-h4 > .outline-item { padding-left: 3em; } .outline-h5 > .outline-item { padding-left: 4em; } .outline-h6 > .outline-item { padding-left: 5em; } .outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; } .outline-label:hover { text-decoration: underline; } .outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); } .outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; } .outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; } .outline-item-open > .outline-item > .outline-expander::before { content: "ï„£"; } .outline-children { display: none; } .info-panel-tab-wrapper { display: none; } .outline-item-open > .outline-children { display: block; } .typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; } .typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; } .typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; } .typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "âˆ’"; } .typora-export-collapse-outline .outline-children { display: none; } .typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; } .typora-export-no-collapse-outline .outline-expander::before { content: "" !important; } .typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; } .md-inline-math-container mjx-container { zoom: 0.95; } .CodeMirror { height: auto; } .CodeMirror.cm-s-inner { background: inherit; } .CodeMirror-scroll { overflow: auto hidden; z-index: 3; } .CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); } .CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; } .CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); } .cm-s-inner .cm-keyword { color: rgb(119, 0, 136); } .cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); } .cm-s-inner .cm-number { color: rgb(17, 102, 68); } .cm-s-inner .cm-def { color: rgb(0, 0, 255); } .cm-s-inner .cm-variable { color: rgb(0, 0, 0); } .cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); } .cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); } .cm-s-inner .cm-string { color: rgb(170, 17, 17); } .cm-s-inner .cm-property { color: rgb(0, 0, 0); } .cm-s-inner .cm-operator { color: rgb(152, 26, 26); } .cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); } .cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); } .cm-s-inner .cm-meta { color: rgb(85, 85, 85); } .cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); } .cm-s-inner .cm-builtin { color: rgb(51, 0, 170); } .cm-s-inner .cm-bracket { color: rgb(153, 153, 119); } .cm-s-inner .cm-tag { color: rgb(17, 119, 0); } .cm-s-inner .cm-attribute { color: rgb(0, 0, 204); } .cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); } .cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); } .cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); } .cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); } .cm-negative { color: rgb(221, 68, 68); } .cm-positive { color: rgb(34, 153, 34); } .cm-header, .cm-strong { font-weight: 700; } .cm-del { text-decoration: line-through; } .cm-em { font-style: italic; } .cm-link { text-decoration: underline; } .cm-error { color: red; } .cm-invalidchar { color: red; } .cm-constant { color: rgb(38, 139, 210); } .cm-defined { color: rgb(181, 137, 0); } div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); } div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); } .cm-s-inner .CodeMirror-activeline-background { background: inherit; } .CodeMirror { position: relative; overflow: hidden; } .CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; } .CodeMirror-sizer { position: relative; } .CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; } .CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; } .CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; } .CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; } .CodeMirror-gutter-filler { left: 0px; bottom: 0px; } .CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; } .CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; } .CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; } .CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; } .CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; } .CodeMirror-lines { cursor: text; } .CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; } .CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; } .CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; } .CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; } .CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; } .CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; } .CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; } .CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; } .CodeMirror-measure pre { position: static; } .CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; } .CodeMirror div.CodeMirror-cursor { visibility: hidden; } .CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; } .cm-searching { background: rgba(255, 255, 0, 0.4); } span.cm-underlined { text-decoration: underline; } span.cm-strikethrough { text-decoration: line-through; } .cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); } .cm-tw-deleted { text-decoration: line-through; } .cm-tw-header5 { font-weight: 700; } .cm-tw-listitem:first-child { padding-left: 10px; } .cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; } .cm-tw-underline { text-decoration: underline; } @media print { .CodeMirror div.CodeMirror-cursor { visibility: hidden; } } :root { --side-bar-bg-color: #fafafa; --control-text-color: #777; } @include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext); /* open-sans-regular - latin-ext_latin */ /* open-sans-italic - latin-ext_latin */ /* open-sans-700 - latin-ext_latin */ /* open-sans-700italic - latin-ext_latin */ html { font-size: 16px; -webkit-font-smoothing: antialiased; } body { font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif; color: rgb(51, 51, 51); line-height: 1.6; } #write { max-width: 860px; margin: 0 auto; padding: 30px; padding-bottom: 100px; } @media only screen and (min-width: 1400px) { #write { max-width: 1024px; } } @media only screen and (min-width: 1800px) { #write { max-width: 1200px; } } #write > ul:first-child, #write > ol:first-child{ margin-top: 30px; } a { color: #4183C4; } h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; } h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; } h1 tt, h1 code { font-size: inherit; } h2 tt, h2 code { font-size: inherit; } h3 tt, h3 code { font-size: inherit; } h4 tt, h4 code { font-size: inherit; } h5 tt, h5 code { font-size: inherit; } h6 tt, h6 code { font-size: inherit; } h1 { font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid #eee; } h2 { font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid #eee; } /*@media print { .typora-export h1, .typora-export h2 { border-bottom: none; padding-bottom: initial; } .typora-export h1::after, .typora-export h2::after { content: ""; display: block; height: 100px; margin-top: -96px; border-top: 1px solid #eee; } }*/ h3 { font-size: 1.5em; line-height: 1.43; } h4 { font-size: 1.25em; } h5 { font-size: 1em; } h6 { font-size: 1em; color: #777; } p, blockquote, ul, ol, dl, table{ margin: 0.8em 0; } li>ol, li>ul { margin: 0 0; } hr { height: 2px; padding: 0; margin: 16px 0; background-color: #e7e7e7; border: 0 none; overflow: hidden; box-sizing: content-box; } li p.first { display: inline-block; } ul, ol { padding-left: 30px; } ul:first-child, ol:first-child { margin-top: 0; } ul:last-child, ol:last-child { margin-bottom: 0; } blockquote { border-left: 4px solid #dfe2e5; padding: 0 15px; color: #777777; } blockquote blockquote { padding-right: 0; } table { padding: 0; word-break: initial; } table tr { border: 1px solid #dfe2e5; margin: 0; padding: 0; } table tr:nth-child(2n), thead { background-color: #f8f8f8; } table th { font-weight: bold; border: 1px solid #dfe2e5; border-bottom: 0; margin: 0; padding: 6px 13px; } table td { border: 1px solid #dfe2e5; margin: 0; padding: 6px 13px; } table th:first-child, table td:first-child { margin-top: 0; } table th:last-child, table td:last-child { margin-bottom: 0; } .CodeMirror-lines { padding-left: 4px; } .code-tooltip { box-shadow: 0 1px 1px 0 rgba(0,28,36,.3); border-top: 1px solid #eef2f2; } .md-fences, code, tt { border: 1px solid #e7eaed; background-color: #f8f8f8; border-radius: 3px; padding: 0; padding: 2px 4px 0px 4px; font-size: 0.9em; } code { background-color: #f3f4f4; padding: 0 2px 0 2px; } .md-fences { margin-bottom: 15px; margin-top: 15px; padding-top: 8px; padding-bottom: 6px; } .md-task-list-item > input { margin-left: -1.3em; } @media print { html { font-size: 13px; } table, pre { page-break-inside: avoid; } pre { word-wrap: break-word; } } .md-fences { background-color: #f8f8f8; } #write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: #f7f7f7; border: 0; border-radius: 3px; color: #777777; margin-top: 0 !important; } .mathjax-block>.code-tooltip { bottom: .375rem; } .md-mathjax-midline { background: #fafafa; } #write>h3.md-focus:before{ left: -1.5625rem; top: .375rem; } #write>h4.md-focus:before{ left: -1.5625rem; top: .285714286rem; } #write>h5.md-focus:before{ left: -1.5625rem; top: .285714286rem; } #write>h6.md-focus:before{ left: -1.5625rem; top: .285714286rem; } .md-image>.md-meta { /*border: 1px solid #ddd;*/ border-radius: 3px; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; } .md-tag { color: #a7a7a7; opacity: 1; } .md-toc { margin-top:20px; padding-bottom:20px; } .sidebar-tabs { border-bottom: none; } #typora-quick-open { border: 1px solid #ddd; background-color: #f8f8f8; } #typora-quick-open-item { background-color: #FAFAFA; border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee; border-style: solid; border-width: 1px; } /** focus mode */ .on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); } header, .context-menu, .megamenu-content, footer{ font-family: "Segoe UI", "Arial", sans-serif; } .file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state{ visibility: visible; } .mac-seamless-mode #typora-sidebar { background-color: #fafafa; background-color: var(--side-bar-bg-color); } .md-lang { color: #b4654d; } /*.html-for-mac { --item-hover-bg-color: #E6F0FE; }*/ #md-notification .btn { border: 0; } .dropdown-menu .divider { border-color: #e5e5e5; opacity: 0.4; } .ty-preferences .window-content { background-color: #fafafa; } .ty-preferences .nav-group-item.active { color: white; background: #999; } .menu-item-container a.menu-style-btn { background-color: #f5f8fa; background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); } mjx-container[jax="SVG"] { direction: ltr; } mjx-container[jax="SVG"] > svg { overflow: visible; min-height: 1px; min-width: 1px; } mjx-container[jax="SVG"] > svg a { fill: blue; stroke: blue; } mjx-assistive-mml { position: absolute !important; top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0px 0px 0px !important; border: 0px !important; display: block !important; width: auto !important; overflow: hidden !important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } mjx-assistive-mml[display="block"] { width: 100% !important; } mjx-container[jax="SVG"][display="true"] { display: block; text-align: center; margin: 1em 0; } mjx-container[jax="SVG"][display="true"][width="full"] { display: flex; } mjx-container[jax="SVG"][justify="left"] { text-align: left; } mjx-container[jax="SVG"][justify="right"] { text-align: right; } g[data-mml-node="merror"] > g { fill: red; stroke: red; } g[data-mml-node="merror"] > rect[data-background] { fill: yellow; stroke: none; } g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] { stroke-width: 70px; fill: none; } g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] { stroke-width: 70px; fill: none; } g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed { stroke-dasharray: 140; } g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted { stroke-linecap: round; stroke-dasharray: 0,140; } g[data-mml-node="mtable"] > g > svg { overflow: visible; } [jax="SVG"] mjx-tool { display: inline-block; position: relative; width: 0; height: 0; } [jax="SVG"] mjx-tool > mjx-tip { position: absolute; top: 0; left: 0; } mjx-tool > mjx-tip { display: inline-block; padding: .2em; border: 1px solid #888; font-size: 70%; background-color: #F8F8F8; color: black; box-shadow: 2px 2px 5px #AAAAAA; } g[data-mml-node="maction"][data-toggle] { cursor: pointer; } mjx-status { display: block; position: fixed; left: 1em; bottom: 1em; min-width: 25%; padding: .2em .4em; border: 1px solid #888; font-size: 90%; background-color: #F8F8F8; color: black; } foreignObject[data-mjx-xml] { font-family: initial; line-height: normal; overflow: visible; } mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] { stroke-width: 3; } g[data-mml-node="xypic"] path { stroke-width: inherit; } .MathJax g[data-mml-node="xypic"] path { stroke-width: inherit; } mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] { stroke-width: 0; } </style> IMC\_Readme

# Image Matching Challenge 2022![avatar](https://storage.googleapis.com/kaggle-competitions/kaggle/34970/logos/header.png?t=2022-03-30-01-06-45)

**Register two images from different viewpoints**

[Image Matching Challenge 2022 | Kaggle](https://www.kaggle.com/competitions/image-matching-challenge-2022)

## æ¯”èµ›ä»‹ç»

ä»**å›¾åƒé‡å»º3Dæ¨¡å‹**ï¼Œé€šå¸¸æ¥è¯´éœ€è¦ç†Ÿç»ƒçš„æ“ä½œå‘˜åœ¨å—æ§æ¡ä»¶é‡‡é›†ç…§ç‰‡ï¼Œæ¥ä¿è¯æ•°æ®çš„å‡åŒ€å’Œé«˜è´¨é‡ã€‚æœ¬æ¬¡æ¯”èµ›ç”±Google Researchä¸»åŠï¼ŒGoogleå·²ç»åœ¨è°·æ­Œåœ°å›¾ä¸Šå®ç°äº†**ä»æ™®é€šè¡—æ™¯å’Œèˆªæ‹å›¾åƒåˆ›å»º3Dæ¨¡å‹**ï¼Œå…¶ä¸­ä½¿ç”¨æœ€æ–°çš„è®¡ç®—æœºè§†è§‰èµ·åˆ°äº†å…³é”®çš„ä½œç”¨ã€‚æœ¬æ¬¡æ¯”èµ›å‚èµ›é€‰æ‰‹å°±éœ€è¦é€šè¿‡å±€éƒ¨ç‰¹å¾ï¼Œæ•è·å…´è¶£ç‚¹å‘¨å›´çš„æè¿°å‘é‡ï¼Œä»¥åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªå›¾åƒçš„å›¾åƒä½ç½®çš„åƒç´ åæ ‡ä¹‹é—´å»ºç«‹å¯¹åº”å…³ç³»ã€‚

* ç«èµ›ç±»å‹ï¼šæœ¬æ¬¡ç«èµ›å±äº**è®¡ç®—æœºè§†è§‰/å±€éƒ¨ç‰¹å¾**ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨çš„æ¨¡å‹æˆ–è€…åº“ï¼š**DKM/SuperGlue/Kornia/QuadTreeAttention/Loftr**
* èµ›é¢˜æ•°æ®ï¼šåœ¨æœ¬æ¬¡æ¯”èµ›æ•°æ®æ˜¯åŒ…å«å…·æœ‰ä¸åŒé‡å ç¨‹åº¦çš„åŸå¸‚åœºæ™¯çš„ç…§ç‰‡ã€‚æ•°æ®è§„æ¨¡ä¸Šï¼Œè®­ç»ƒé›†åŒ…å«5678å¤šå¼ å›¾ç‰‡ï¼›éšè—æµ‹è¯•é›†ä¸­å¤§çº¦ åŒ…å«10,000 å¯¹å›¾åƒï¼Œä½†**æµ‹è¯•æ•°æ®ä¸è®­ç»ƒæ•°æ®æ¥æºä¸åŒ**ã€‚æ‰€æœ‰å›¾åƒå·²è°ƒæ•´å¤§å°ï¼Œä½¿æœ€é•¿è¾¹ç¼˜çº¦ä¸º 800 åƒç´ ï¼Œå¯èƒ½å…·æœ‰ä¸åŒçš„çºµæ¨ªæ¯”ï¼ˆåŒ…æ‹¬çºµå‘å’Œæ¨ªå‘ï¼‰ã€‚
* è¯„ä¼°æ ‡å‡†ï¼š**mAA \(mean Average Accuracy\)**ã€‚å‚ä¸è€…è¢«è¦æ±‚ä¼°è®¡ä¸€å¼ å›¾ç‰‡ç›¸å¯¹äºå¦ä¸€å¼ å›¾ç‰‡çš„ç›¸å¯¹å§¿åŠ¿ã€‚æäº¤çš„æ•°æ®æ ¹æ®è¯„ä¼°å§¿åŠ¿çš„ mAA è¿›è¡Œè¯„ä¼°ã€‚ç»™å®šä¸€ä¸ªfundamental matrix å’Œéšè—çš„ ground truthï¼Œæˆ‘ä»¬ä¾æ®æ—‹è½¬\(ÏµR\\epsilon\_R , in degrees\) å’Œå¹³ç§»\(ÏµT\\epsilon\_T , in meters\) è®¡ç®—è¯¯å·®ã€‚ç»™å‡ºæ¯ä¸€ä¸ªé˜ˆå€¼ï¼Œå¦‚æœä¸€ä¸ªå§¿åŠ¿åŒæ—¶æ»¡è¶³ä¸¤ä¸ªé˜ˆå€¼ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒå½’ç±»ä¸ºå‡†ç¡®çš„å§¿åŠ¿ã€‚æˆ‘ä»¬å¯¹10å¯¹é˜ˆå€¼è¿›è¡Œåˆ†ç±»ï¼Œæ¯æ¬¡ä¸€å¯¹ï¼ˆä¾‹å¦‚ï¼Œåœ¨æœ€ç»†çš„çº§åˆ«ä¸Šæ˜¯1o1\^oå’Œ20å˜ç±³ï¼Œåœ¨æœ€ç²—çš„çº§åˆ«ä¸Šæ˜¯10o10\^oå’Œ5ç±³ï¼‰ã€‚ è¯¦è§ï¼š[Image Matching Challenge 2022 | Kaggle](https://www.kaggle.com/competitions/image-matching-challenge-2022/overview/evaluation)
* æ¨èé˜…è¯» Kaggle å†…çš„ä¸€ç¯‡ EDAï¼ˆæ¢ç´¢æ•°æ®åˆ†æï¼‰æ¥è·å–ä¸€äº›é¢„å¤‡çŸ¥è¯†ï¼š[imc2022-training-data | Kaggle](https://www.kaggle.com/code/eduardtrulls/imc2022-training-data)

## æ•°æ®è¯´æ˜

åœ¨æœ¬æ¬¡æ¯”èµ›æ•°æ®æ˜¯åŒ…å«å…·æœ‰ä¸åŒé‡å ç¨‹åº¦çš„åŸå¸‚åœºæ™¯çš„ç…§ç‰‡ã€‚æ•°æ®è§„æ¨¡ä¸Šï¼Œè®­ç»ƒé›†åŒ…å«5678å¤šå¼ å›¾ç‰‡ï¼›éšè—æµ‹è¯•é›†ä¸­å¤§çº¦ åŒ…å«10,000 å¯¹å›¾åƒï¼Œä½†**æµ‹è¯•æ•°æ®ä¸è®­ç»ƒæ•°æ®æ¥æºä¸åŒ**ã€‚æ‰€æœ‰å›¾åƒå·²è°ƒæ•´å¤§å°ï¼Œä½¿æœ€é•¿è¾¹ç¼˜çº¦ä¸º 800 åƒç´ ï¼Œå¯èƒ½å…·æœ‰ä¸åŒçš„çºµæ¨ªæ¯”ï¼ˆåŒ…æ‹¬çºµå‘å’Œæ¨ªå‘ï¼‰ã€‚

å®˜æ–¹æ•°æ®é¡µé¢ [Image Matching Challenge 2022 | Kaggle](https://www.kaggle.com/competitions/image-matching-challenge-2022/data)

* train/\*/calibration.csv

  * image\_id - å›¾åƒæ–‡ä»¶åã€‚
  * camera\_intrinsics - å›¾åƒçš„3\*3 **æ ¡å‡†çŸ©é˜µK**ã€‚é€šè¿‡è¡Œç´¢å¼•å°†å…¶å±•å¹³ä¸ºå‘é‡ã€‚
  * rotation\_matrix - å›¾åƒçš„3\*3 **æ—‹è½¬çŸ©é˜µR**ã€‚é€šè¿‡è¡Œç´¢å¼•å°†å…¶å±•å¹³ä¸ºå‘é‡ã€‚
  * translation\_vector - **å¹³ç§»å‘é‡T**ã€‚

* train/\*/pair\_covisibility.csv

  * pair - æ ‡è¯†ä¸€å¯¹å›¾åƒçš„å­—ç¬¦ä¸²ï¼Œç¼–ç ä¸ºä¸¤ä¸ªå›¾åƒæ–‡ä»¶åï¼ˆä¸å¸¦æ‰©å±•åï¼‰ï¼Œç”±è¿å­—ç¬¦åˆ†éš”ï¼Œå¦‚key1-key2, å…¶ä¸­key1> key2
  * covisibility - ä¼°è®¡ä¸¤ä¸ªå›¾åƒä¹‹é—´çš„é‡å ã€‚æ•°å­—è¶Šå¤§è¡¨ç¤ºé‡å è¶Šå¤§ã€‚æˆ‘ä»¬å»ºè®®ä½¿ç”¨æ‰€æœ‰å…·æœ‰ 0.1 æˆ–æ›´é«˜å…±å¯è§æ€§ä¼°è®¡å€¼çš„å¯¹
  * fundamental\_matrix - æ¥è‡ªæ ¡å‡†æ–‡ä»¶çš„**targetsåˆ—**ã€‚

* train/scaling\_factors.csv

  * é€šè¿‡Structure-from-Motioné‡å»ºçš„æ¯ä¸ªåœºæ™¯çš„å§¿åŠ¿ï¼Œå¹¶ä¸”åªèƒ½ç²¾ç¡®åˆ°æ¯”ä¾‹å› å­ã€‚è¯¥æ–‡ä»¶åŒ…å«æ¯ä¸ªåœºæ™¯çš„æ ‡é‡ï¼Œå¯ç”¨äºå°† å®ƒä»¬è½¬æ¢ä¸ºè·ç¦»ã€‚

* train/\*/images

  * åœ¨åŒä¸€ä½ç½®é™„è¿‘æ‹æ‘„çš„å›¾åƒã€‚

* test.csv

  * sample\_id - å›¾åƒå¯¹çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚
  * batch\_id - æ‰¹æ¬¡ç¼–å·ã€‚
  * image\_\[1/2\]\_id - å¯¹ä¸­æ¯ä¸ªå›¾åƒçš„æ–‡ä»¶åã€‚

Â 

## ä¸“ä¸šæ¦‚å¿µ

æ¯”èµ›çš„ç›®æ ‡æ˜¯ä¼°è®¡ä¸¤å¹…å›¾åƒä¹‹é—´çš„ç›¸å¯¹å§¿æ€ã€‚è¿™éœ€è¦ä¸€äº›å…³äº**æŠ•å½±projective** å’Œ **å¯¹æå‡ ä½•epipolar geometry** çš„çŸ¥è¯†ï¼Œç‰¹åˆ«æ˜¯å…³äºä»¥ä¸‹æ–¹é¢ã€‚

* **calibration matrix æ ¡å‡†çŸ©é˜µğŠ** æ•æ‰äº†å†³å®šä¸‰ç»´ç‚¹å’ŒäºŒç»´ï¼ˆåƒç´ ï¼‰åæ ‡ä¹‹é—´è½¬æ¢çš„ç›¸æœºå±æ€§ã€‚å®ƒä¹Ÿè¢«ç§°ä¸º**ç›¸æœºå†…å‚ camera intrinsics**ã€‚
* **rotation matrix æ—‹è½¬çŸ©é˜µğ‘** å’Œ **translation vector å¹³ç§»çŸ¢é‡ğ“** æ•æ‰æ‘„åƒæœºåœ¨å…¨å±€å‚è€ƒæ¡†æ¶ä¸­çš„ 6è‡ªç”±åº¦å§¿åŠ¿ï¼ˆä½ç½®å’Œæ–¹å‘ï¼‰ã€‚å®ƒä»¬è¢«ç»Ÿç§°ä¸º **ç›¸æœºå¤–å‚ camera extrinsic** ã€‚
* **fundamental matrix åŸºæœ¬çŸ©é˜µğ…** å°è£…äº†åŒä¸€åœºæ™¯çš„ä¸¤ä¸ªè§†å›¾ä¹‹é—´çš„æŠ•å½±å‡ ä½•ã€‚å®ƒä¸å—åœºæ™¯ä¸­å†…å®¹çš„å½±å“ï¼Œåªå–å†³äºä¸¤å°æ‘„åƒæœºçš„å†…å‚å’Œå¤–å‚ã€‚

è®­ç»ƒæ•°æ®æä¾›äº†ğŠã€ğ‘å’Œğ“ä½œä¸ºground truthã€‚å‚ä¸è€…è¢«è¦æ±‚ä¼°è®¡ğ…ã€‚æˆ‘ä»¬åœ¨ä¸‹æ–‡ä¸­æ›´è¯¦ç»†åœ°è§£é‡Šè¿™äº›æ¦‚å¿µã€‚

Â 

## Projective geometry æŠ•å½±å‡ ä½•

åœ¨è®¡ç®—æœºè§†è§‰ä¸­ï¼Œä¸‰ç»´ï¼ˆä¸–ç•Œï¼‰å’ŒäºŒç»´ï¼ˆå›¾åƒï¼‰ä¹‹é—´çš„è½¬æ¢æ˜¯ç”±æŠ•å½±å‡ ä½•å­¦æ¥æ§åˆ¶çš„ã€‚æˆ‘ä»¬ä½¿ç”¨æœ€ç®€å•çš„ç›¸æœºæ¨¡å‹ï¼Œå³é’ˆå­”ç›¸æœºçš„æ¨¡å‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![image-20220611155358501](IMC_Readme.assets/image-20220611155358501.png)

ä¸‰ç»´ç‚¹ğŒğ¢ï¼Œä»¥ç±³ä¸ºå•ä½ï¼ŒæŠ•å½±åˆ°äºŒç»´åæ ‡ mim\_iï¼Œä»¥åƒç´ ä¸ºå•ä½ï¼Œå¯ä»¥ç®€å•å†™æˆğ¦ğ¢=ğŠğŒğ¢ï¼Œå…¶ä¸­ğŠä¸ºæ ¡å‡†çŸ©é˜µã€‚

![image-20220611155439272](IMC_Readme.assets/3AC72lsnmO9eHNM.png)

å…¶ä¸­ğ‘“ğ‘¥,ğ‘“ğ‘¦æ˜¯å¯¹ğ‘¥å’Œğ‘¦çš„ç„¦è·ï¼Œğ‘¢0ï¼Œğ‘£0æ˜¯ **åƒä¸»ç‚¹åç§»**  _principal point offsets_ã€‚å›¾åƒæ²¡æœ‰å¾„å‘ç•¸å˜radial distortionã€‚

è¯·æ³¨æ„ï¼Œè¿™ä¸ªæ–¹ç¨‹åªå¯¹ç›¸æœºï¼ˆcï¼‰åæ ‡ç³»ä¸­çš„ä¸‰ç»´ç‚¹æœ‰æ•ˆã€‚ç»™å®š "world"ï¼ˆwï¼‰åæ ‡ç³»ä¸­çš„ç‚¹ï¼Œä»¥åŠç”±3Ã—3æ—‹è½¬çŸ©é˜µğ‘å’Œ3ç»´å¹³ç§»çŸ¢é‡ğ“ç¼–ç çš„ä½ç½®ä¸Šçš„æ‘„åƒæœºï¼ŒæŠ•å½±å¯ä»¥å†™æˆï¼š

ğ¦ğ¢=ğŠ\(ğ‘ğŒğ¢+ğ“\)

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ‰€è¯´çš„ "world"æ˜¯æŒ‡ä¸€ä¸ªåœºæ™¯ä¸­ä¸åŒæ‘„åƒæœºä¹‹é—´å…±åŒçš„åæ ‡ç³»ç»Ÿï¼Œè€Œä¸æ˜¯ç»å¯¹çš„ï¼ˆåœ°ç†å®šä½ï¼‰ã€‚

Â 

### Epipolar geometry å¯¹æå‡ ä½•

å¤–æå‡ ä½•å­¦æ˜¯ä¸¤ä¸ªè§†å›¾ä¹‹é—´çš„æŠ•å½±å‡ ä½•å­¦ã€‚å®ƒä¸ä¾èµ–äºåœºæ™¯çš„ç»“æ„ï¼ˆå†…å®¹ï¼‰ï¼šå®ƒåªä¾èµ–äºç›¸å¯¹å§¿åŠ¿ï¼ˆå¤–å‚ï¼‰å’Œç›¸æœºå†…éƒ¨å‚æ•°ï¼ˆå†…å‚ï¼‰ã€‚

åœ¨è®¡ç®—æœºè§†è§‰ä¸­ï¼Œè¿™ç§å…³ç³»é€šå¸¸è¡¨ç¤ºä¸ºfundamental matrixï¼Œä¸€ä¸ª2ç»´çš„3Ã—3çŸ©é˜µã€‚

ç»™å®šä¸€ä¸ªä¸‰ç»´ç‚¹ğ‘€ğ‘–ï¼Œä»¥ç±³ä¸ºå•ä½ï¼Œå…¶åœ¨ä¸¤ä¸ªä¸åŒç›¸æœºä¸Šçš„æŠ•å½± mim\_iå’Œ miâ€²m'\_iï¼Œä»¥åƒç´ ä¸ºå•ä½ï¼Œè¿™ä¸¤ä¸ªè§†å›¾çš„åŸºæœ¬çŸ©é˜µğ…å¿…é¡»æ»¡è¶³miâ€²TFmi\=0m'\^T\_iFm\_i = 0ã€‚ä½ å¯ä»¥ç”¨å…«ç‚¹ç®—æ³•ä»ä¸€ç»„ç¨€ç–çš„å¯¹åº”å…³ç³»ä¸­è®¡ç®—å‡ºåŸºæœ¬çŸ©é˜µï¼Œæˆ–è€…ç”¨OpenCVæˆ–Korniaç­‰åº“æ›´å®é™…åœ°è®¡ç®—ã€‚

Â 

æ¨èç›¸å…³è¯¾ç¨‹ï¼š[Camera Calibration | Uncalibrated Stereo \- YouTube](https://www.youtube.com/playlist?list=PL2zRqk16wsdoCCLpou-dGo7QQNks1Ppzo)

Â 

## è§£å†³æ–¹æ¡ˆæ€è·¯

æœ¬æ¬¡ç«èµ›æˆ‘ä»¬çš„æ–¹æ¡ˆæ˜¯åŸºäºå››ä¸ªä¸åŒæ¨¡å‹çš„åŒ¹é…ç»“æœçš„èåˆã€‚**LoFTRã€SuperGlueã€DKM å’Œ QuadTreeAttention**ã€‚å®ƒä»¬éƒ½ä½¿ç”¨å…¬å¼€çš„é¢„è®­ç»ƒæƒé‡ï¼Œæ²¡æœ‰ç»è¿‡è®­ç»ƒæˆ–å¾®è°ƒï¼ŒåŸå› æ˜¯ç”±äºè¿™æ¬¡æ¯”èµ›çš„è®­ç»ƒå’Œæµ‹è¯•æ•°æ®çš„åˆ†å¸ƒä¸åŒï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™æ ·åšçš„æ•ˆæœä¼šæ¯”è¾ƒå·®ã€‚ä¹‹åæˆ‘ä»¬å¯¹è°ƒå¤§äº†åŸå§‹å›¾åƒå°ºå¯¸ï¼Œæ¥å¯¹ä¸åŒæ¨¡å‹è¿›è¡Œé€‚é…ï¼Œæœ€ç»ˆæ–¹æ¡ˆä¸Šå„ä¸ªæ¨¡å‹åˆ†è¾¨ç‡åˆ†åˆ«ä¿æŒåœ¨600-1600ä¹‹é—´ã€‚æœ€åæˆ‘ä»¬concatæ‰€æœ‰æ¨¡å‹è¾“å‡ºçš„keypointsï¼Œå¹¶ä½¿ç”¨cv2.USAC\_MAGSACæ¥è®¡ç®—FçŸ©é˜µã€‚ä¸ºäº†åœ¨kaggleè§„å®šçš„9ä¸ªå°æ—¶å†…å®Œæˆå››ä¸ªæ¨¡å‹çš„è¿ç®—ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ThreadPoolExecutorï¼Œå¤šçº¿ç¨‹çš„è¿›è¡Œæ¨ç†keypointså’Œè®¡ç®—FçŸ©é˜µã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å°è¯•äº†Matchformermæ¨¡å‹ã€ä¸åŒæ°´å¹³ç¿»è½¬æ•°æ®å¢å¼ºç­‰å®éªŒï¼Œä½†å¹¶æ²¡æœ‰èµ·åˆ°æ•ˆæœã€‚

#### æ¨¡å‹Ensemble

â€‹x

def inf\_models\_ensemble\(image\_fpath\_1, image\_fpath\_2\):

 '''

 Input : image1 å’Œ image2, è¿›è¡Œinference ensemble

 Return: match keypoints \(åŒ¹é…å…³é”®ç‚¹\)

 '''

 \# loftr

 k\_mkpts1, k\_mkpts2 \= loftr\_inference\(image\_fpath\_1, image\_fpath\_2, kornia\_max\_image\_size\) \# kornia\_max\_image\_size = 1024

 mkpts1\_merge \= k\_mkpts1

 mkpts2\_merge \= k\_mkpts2

 

 \#  QuadTreeAttention

 qta\_mkps1,qta\_mkps2 \= qta\_inference\(image\_fpath\_1, image\_fpath\_2, max\_image\_size\=qta\_max\_img\_size, divide\_coef\=32\) \# qta\_max\_img\_size = 1024

 mkpts1\_merge \= np.concatenate\(\(mkpts1\_merge, qta\_mkps1\), axis\=0\)

 mkpts2\_merge \= np.concatenate\(\(mkpts2\_merge, qta\_mkps2\), axis\=0\)

 

 \# SUPERGLUE

 sg\_mkpts1, sg\_mkpts2 \= superglue\_inference\(image\_fpath\_1, image\_fpath\_2\)

 mkpts1\_merge \= np.concatenate\(\(mkpts1\_merge, sg\_mkpts1\), axis\=0\)

 mkpts2\_merge \= np.concatenate\(\(mkpts2\_merge, sg\_mkpts2\), axis\=0\)

  

 \# DKM

 dkm\_mkpts1, dkm\_mkpts2, \_ \= dkm\_inference\(image\_fpath\_1, image\_fpath\_2\)

 if len\(dkm\_mkpts1\) \> 0:

 mkpts1\_merge \= np.concatenate\(\(mkpts1\_merge, dkm\_mkpts1\), axis\=0\)

 mkpts2\_merge \= np.concatenate\(\(mkpts2\_merge, dkm\_mkpts2\), axis\=0\)

  

 return mkpts1\_merge, mkpts2\_merge \# get match keypoints

Â 

#### è®¡ç®—FçŸ©é˜µ

xxxxxxxxxx

def calc\_F\_matrix\(item\):

 '''

 Input : sample\_id, mkps1, mkps2 # ä¸€å¯¹åŒ¹é…å…³é”®ç‚¹

 Return: F-matrix

 '''

 sample\_id, mkps1, mkps2 \= item 

  

 if len\(mkps1\) \> 7: \# å¦‚æœæœ‰è¶³å¤Ÿçš„ç‚¹, åˆ™è¿›è¡ŒF-matrixè®¡ç®—

 F, \_ \= cv2.findFundamentalMat\(mkps1, mkps2, cv2.USAC\_MAGSAC, ransacReprojThreshold\=0.25, confidence\=0.999999, maxIters\=120\_000\) Â \# è®¡ç®—F-matrix

 else: Â  \# å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„ç‚¹, åˆ™è¿”å›ç©ºçš„F-matrix

 F \= None 

  

 del mkps1, mkps2 \# clean up

 return sample\_id, F

Â 

## æ¯”èµ›ä¸Šåˆ†å†ç¨‹

1.  ä½¿ç”¨LoFTRæ¨¡å‹ç›´æ¥æ¨ç†ï¼ŒPublic LB 0.726ï¼›
2.  å¯¹LoFTRè¿›è¡Œè°ƒå‚ï¼ˆåˆ†è¾¨ç‡/keypointsæ•°é‡/thresholdç­‰ï¼‰ï¼ŒPublic LB 0.767ï¼›
3.  ä½¿ç”¨SuperGlueå¹¶è°ƒå‚ï¼ŒPublic LB : 0.710ï¼›
4.  ä½¿ç”¨QTAå¹¶è°ƒå‚ï¼ŒPublic LB : 0.799ï¼›
5.  ä½¿ç”¨DKMå¹¶è°ƒå‚ï¼ŒPublic LB : 0.600ï¼›
6.  å¯¹å››ä¸ªæ¨¡å‹ç»“æœè¿›è¡Œèåˆï¼ŒPublic LB : 0.830+ï¼›
7.  å¯¹cv2.findFundamentalMatè¿›è¡Œè°ƒå‚ï¼ŒPublic LB : 0.840+ï¼›

Â 

## ä»£ç ã€æ•°æ®é›†

* ä»£ç 

  * IMC\_Inference.ipynb

* æ•°æ®é›†

  * datasets.txt

  * othermodels/

  * pywheels/

  * super-glue-pretrained-network/

Â 

## TL;DR

åœ¨è¿™æ¬¡ç«èµ›ä¸­ï¼Œå‚èµ›è€…å°†ä½¿ç”¨æœºå™¨å­¦ä¹ çš„æ–¹å¼ï¼Œå¯¹åŒä¸€åœºæ™¯ä¸‹çš„ä¸åŒè§’åº¦æ‹æ‘„çš„ç…§ç‰‡è¿›è¡Œå…³é”®ç‚¹åŒ¹é…ï¼Œå¹¶è®¡ç®—å‡º fundamental matrixã€‚å› ä¸ºæœ¬æ¬¡æ¯”èµ›çš„è®­ç»ƒå’Œæµ‹è¯•æ•°æ®çš„åˆ†å¸ƒä¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº†æ‰€æœ‰æ¨¡å‹çš„é¢„è®­ç»ƒæƒé‡ç›´æ¥è¿›è¡Œæ¨ç†ã€‚æˆ‘ä»¬æœ€ç»ˆæ–¹æ¡ˆä½¿ç”¨äº†å››ä¸ªä¸åŒæ¨¡å‹çš„åŒ¹é…ç»“æœçš„èåˆã€‚LoFTRã€SuperGlueã€DKM å’Œ QuadTreeAttentionã€‚æˆ‘ä»¬è¿˜è°ƒæ•´äº†åŸå§‹å›¾åƒå°ºå¯¸ï¼Œæ¥å¯¹ä¸åŒæ¨¡å‹è¿›è¡Œé€‚é…ï¼Œå„ä¸ªæ¨¡å‹åˆ†è¾¨ç‡åˆ†åˆ«ä¿æŒåœ¨600-1600ä¹‹é—´ã€‚ä¸ºäº†åœ¨kaggleè§„å®šçš„9ä¸ªå°æ—¶å†…å®Œæˆå››ä¸ªæ¨¡å‹çš„è¿ç®—ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ThreadPoolExecutorï¼Œå¤šçº¿ç¨‹çš„è¿›è¡Œæ¨ç†keypointså’Œè®¡ç®—FçŸ©é˜µï¼Œå¤§å¹…åŠ å¿«äº†æ¨ç†é€Ÿåº¦ï¼Œæœ€ç»ˆæˆ‘ä»¬è·å¾—äº†å‰1\%çš„æˆç»©ã€‚
